<!-- index.html -->
{% extends "base.html" %}
{% block title %}–¢–∞–ª–∞–ø–∫–µ—Ä ‚Äî –ì–ª–∞–≤–Ω–∞—è{% endblock %}
{% block content %}
<section class="hero">
  <div class="container hero-inner">
    <h1>–ò–ò-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –¥–ª—è –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤</h1>
    <p>–° –ø–æ–º–æ—â—å—é "–¢–∞–ª–∞–ø–∫–µ—Ä" –≤—ã –ª–µ–≥–∫–æ —É–∑–Ω–∞–µ—Ç–µ –≤—Å—ë –æ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–∏ –∏ –ø–æ–¥–∞—á–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</p>
    <!-- —Å—Å—ã–ª–∫–∞ –Ω–∞ id="chat-section" -->
    <a class="btn orange" href="#chat-section">–£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ</a>
  </div>
</section>

<!-- –ß–∞—Ç-–±–æ—Ç -->
<section id="chat-section" class="section container">
  <h2>–ß–∞—Ç —Å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–º</h2>
  <div id="chat-box" class="chat-box">
    <div class="messages" id="messages">
      <div class="message bot">–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –ø–æ–º–æ–≥—É –≤–∞–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ–º. –ó–∞–¥–∞–π—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å üëá</div>
    </div>
    <form id="chat-form" class="chat-form">
      <input type="text" id="user-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å..." required>
      <button type="button" id="voice-btn"><i class="fa-solid fa-microphone"></i></button>
      <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </form>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('chat-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  const input = document.getElementById('user-input');
  const messages = document.getElementById('messages');
  const userMsg = input.value;
  messages.innerHTML += `<div class="message user">${userMsg}</div>`;
  input.value = '';
  const res = await fetch('/api/ai_chat', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ message: userMsg })
  });
  const data = await res.json();
  messages.innerHTML += `<div class="message bot">${data.reply}</div>`;
  messages.scrollTop = messages.scrollHeight; // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
});

const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
recognition.lang = 'ru-RU'; // –î–ª—è –∫–∞–∑–∞—Ö—Å–∫–æ–≥–æ: 'kk-KZ', –¥–ª—è –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ: 'en-US'
recognition.onresult = (event) => {
  document.getElementById('user-input').value = event.results[0][0].transcript;
};
document.getElementById('voice-btn').addEventListener('click', () => {
  recognition.start();
});
</script>
{% endblock %}