{% extends "base.html" %}
{% block title %}–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å{% endblock %}
{% block content %}
<div class="container py-5">
    <h1 class="mb-4">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
    <p class="text-muted">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <strong>{{ current_user.name or current_user.email }}</strong></p>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Äî –°–¢–ï–ö–õ–Ø–ù–ù–´–ï –ö–ê–†–¢–û–ß–ö–ò -->
<div class="row g-4 mb-5">
    <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
    <div class="col-md-4" data-aos="fade-up" data-aos-delay="100">
        <div class="stat-card glass-card bg-primary-glass text-white p-4 rounded-4 shadow-lg position-relative overflow-hidden">
            <div class="d-flex align-items-center">
                <div class="stat-icon me-3">
                    <i class="fas fa-users fa-2x"></i>
                </div>
                <div>
                    <h5 class="mb-1 fw-semibold opacity-90">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h5>
                    <h2 class="mb-0 display-5 fw-bold">{{ users|length }}</h2>
                </div>
            </div>
            <div class="glass-shine"></div>
        </div>
    </div>

    <!-- –¢–µ—Å—Ç—ã -->
    <div class="col-md-4" data-aos="fade-up" data-aos-delay="200">
        <div class="stat-card glass-card bg-success-glass text-white p-4 rounded-4 shadow-lg position-relative overflow-hidden">
            <div class="d-flex align-items-center">
                <div class="stat-icon me-3">
                    <i class="fas fa-check-circle fa-2x"></i>
                </div>
                <div>
                    <h5 class="mb-1 fw-semibold opacity-90">–¢–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ</h5>
                    <h2 class="mb-0 display-5 fw-bold">{{ results|length }}</h2>
                </div>
            </div>
            <div class="glass-shine"></div>
        </div>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    <div class="col-md-4" data-aos="fade-up" data-aos-delay="300">
        <div class="stat-card glass-card bg-warning-glass text-white p-4 rounded-4 shadow-lg position-relative overflow-hidden">
            <div class="d-flex align-items-center">
                <div class="stat-icon me-3">
                    <i class="fas fa-envelope fa-2x"></i>
                </div>
                <div>
                    <h5 class="mb-1 fw-semibold opacity-90">–°–æ–æ–±—â–µ–Ω–∏–π</h5>
                    <h2 class="mb-0 display-5 fw-bold">{{ contact_messages|length }}</h2>
                </div>
            </div>
            <div class="glass-shine"></div>
        </div>
    </div>
</div>
    <!-- –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="card border-0 shadow-lg" data-aos="fade-up" data-aos-delay="400">
        <div class="card-header bg-gradient text-white" style="background: linear-gradient(135deg, #1f2d3d, #2b8cff); border-radius: 16px 16px 0 0;">
            <h3 class="mb-0">
                <i class="fas fa-bell me-2"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            </h3>
        </div>
        <div class="card-body p-4" style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border-radius: 0 0 16px 16px;">
            <form id="notificationForm">
                <div class="mb-3">
                    <label for="notifTitle" class="form-label fw-semibold text-dark">
                        <i class="fas fa-heading text-primary"></i> –ó–∞–≥–æ–ª–æ–≤–æ–∫
                    </label>
                    <input type="text" class="form-control form-control-lg shadow-sm" id="notifTitle" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–∏—ë–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∑–∞–≤–µ—Ä—à—ë–Ω" required>
                </div>

                <div class="mb-3">
                    <label for="notifMessage" class="form-label fw-semibold text-dark">
                        <i class="fas fa-comment-dots text-success"></i> –°–æ–æ–±—â–µ–Ω–∏–µ
                    </label>
                    <textarea class="form-control shadow-sm" id="notifMessage" rows="4" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è..." required></textarea>
                </div>

                <div class="mb-3">
                    <label for="notifType" class="form-label fw-semibold text-dark">
                        <i class="fas fa-tag text-warning"></i> –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                    </label>
                    <select class="form-select form-select-lg shadow-sm" id="notifType">
                        <option value="info">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</option>
                        <option value="success">‚úÖ –£—Å–ø–µ—Ö</option>
                        <option value="warning">‚ö†Ô∏è –í–∞–∂–Ω–æ</option>
                        <option value="urgent">üî• –°—Ä–æ—á–Ω–æ</option>
                    </select>
                </div>

                <div class="mb-4">
                    <label class="form-label fw-semibold text-dark">
                        <i class="fas fa-paper-plane text-accent"></i> –ö–æ–º—É –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
                    </label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="recipient" id="allUsers" value="all" checked>
                        <label class="form-check-label" for="allUsers">
                            –í—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="recipient" id="specificUser" value="specific">
                        <label class="form-check-label" for="specificUser">
                            –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                        </label>
                    </div>
                    <div id="userSelectWrapper" class="mt-2" style="display: none;">
                        <select class="form-select shadow-sm" id="specificUserSelect">
                            <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî</option>
                            {% for user in users %}
                            <option value="{{ user.id }}">{{ user.name or user.email }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="d-grid d-md-flex justify-content-end gap-2">
                    <button type="button" class="btn btn-outline-secondary btn-lg px-4" onclick="clearForm()">
                        <i class="fas fa-eraser"></i> –û—á–∏—Å—Ç–∏—Ç—å
                    </button>
                    <button type="submit" class="btn btn-orange btn-lg px-5 shadow-sm">
                        <i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–≤—Å–ø–ª—ã–≤–∞—é—â–∏–π) -->
    <div id="previewToast" class="toast align-items-center text-white border-0 position-fixed bottom-0 end-0 p-3" style="z-index: 11000; display: none;" role="alert">
        <div class="d-flex">
            <div class="toast-body fw-semibold">
                <span id="previewIcon"></span> <span id="previewText"></span>
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    </div>
</div>

<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ AOS –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π -->
<link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
<script>
    AOS.init({ duration: 600, once: true });

    // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    document.querySelectorAll('input[name="recipient"]').forEach(radio => {
        radio.addEventListener('change', function() {
            document.getElementById('userSelectWrapper').style.display = 
                this.value === 'specific' ? 'block' : 'none';
        });
    });

    // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
    function clearForm() {
        document.getElementById('notificationForm').reset();
        document.getElementById('userSelectWrapper').style.display = 'none';
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã (–∑–∞–≥–ª—É—à–∫–∞)
    document.getElementById('notificationForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const title = document.getElementById('notifTitle').value;
        const message = document.getElementById('notifMessage').value;
        const type = document.getElementById('notifType').value;

        const icons = {
            info: '‚ÑπÔ∏è',
            success: '‚úÖ',
            warning: '‚ö†Ô∏è',
            urgent: 'üî•'
        };

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ—Å—Ç-–ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
        const toast = document.getElementById('previewToast');
        const iconEl = document.getElementById('previewIcon');
        const textEl = document.getElementById('previewText');

        iconEl.textContent = icons[type];
        textEl.textContent = title;

        toast.className = `toast align-items-center text-white border-0 position-fixed bottom-0 end-0 p-3 bg-${type === 'info' ? 'primary' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'danger'}`;
        toast.style.display = 'block';

        const bsToast = new bootstrap.Toast(toast);
        bsToast.show();

        // –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
        setTimeout(() => {
            clearForm();
        }, 800);
    });
</script>

<style>
    .bg-gradient {
        background: linear-gradient(135deg, #1f2d3d, #2b8cff) !important;
    }
    .btn-orange {
        background: var(--accent-color);
        color: white;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    .btn-orange:hover {
        background: #e09e0c;
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(255, 179, 15, 0.3);
    }
    .form-control, .form-select {
        border-radius: 12px;
        padding: 12px 16px;
        font-size: 1rem;
    }
    .form-control:focus, .form-select:focus {
        border-color: var(--accent-color);
        box-shadow: 0 0 0 0.2rem rgba(255, 179, 15, 0.25);
    }
    .card {
        border-radius: 16px;
        overflow: hidden;
    }
    .toast {
        border-radius: 12px;
        backdrop-filter: blur(10px);
    }
</style>
{% endblock %}